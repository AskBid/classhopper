-- | to be used with @cabal repl geometry-tests@
module Test where

import qualified Geometry.Surface as GS
import qualified Geometry.Curve as GC
import Geometry.Type
import Geometry.Knot

import Data.Maybe

import Linear (V3(..))

flattenV3List :: [V3 Double] -> [Double]
flattenV3List = concatMap (\(V3 x y z) -> [x, y, z])

dU = 5
dV = 6
kU = [-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,1.0,1.0,1.0,1.0,1.0,1.0] 
kV = [-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,-1.0263552373438e-5,1.0,1.0,1.0,1.0,1.0,1.0,1.0]
cps = [269.165302563184,63.391792215776,167.217053747617,270.54556194454,66.8998787074975,161.62992072624,271.975675083398,70.3138687736612,156.001980102762,273.371922772463,72.3440657566939,150.175787080646,274.692020795593,72.4256137379439,144.517012305052,276.15800060784,71.9228273622808,138.211558627886,276.70374665252,64.9427804885946,170.456029959578,278.415909421056,68.4144960647175,164.92868933315,280.096493243076,71.7597349964871,159.314190907076,281.780583930815,73.7603100963802,153.639417434267,283.417388283694,73.8777161532868,148.05756393468,285.261474328171,73.4294805302035,141.897301900162,284.308455378448,66.6657933000366,173.777659536525,286.24626631169,70.0343583026427,168.228478191767,288.198770713712,73.2619662286346,162.579882947568,290.16022778064,75.164134745666,157.074434785683,292.147951172788,75.3274099670648,151.573300090297,294.398719861095,74.9284284005927,145.511548621546,291.786371602405,68.6521313529861,176.988423544871,294.056428325246,71.7696904421119,171.572955040595,296.345475201289,74.8505265142838,165.893631663784,298.622665372697,76.5766975961129,160.471347266668,300.964281587002,76.7818173481321,155.080274097705,303.578673039662,76.427925858715,149.132899733446,299.282877697392,70.7444893941002,180.05067642374,301.780303658181,73.5979437205572,174.714980863937,304.339692921861,76.432666851318,169.118537750591,306.9498828453,77.9674632710428,163.797633357452,309.619172248979,78.2098268911083,158.508273030266,312.671301809513,77.8990612770439,152.645977291669,306.922426478111,73.4620783711932,182.925235513534,309.754255493514,75.7790844785565,177.69550986955,312.597558271912,78.0329198276471,172.301323397218,315.503895092706,79.4122906657675,167.186233641042,318.509190249049,79.6716297856352,162.005968564994,321.922396824068,79.3974689013546,156.272225560736,314.416407321578,76.3629969113317,185.374194244147,317.589465984792,78.030621353536,180.336191319139,320.634041433788,79.6301506569908,175.338706944543,323.837453488254,80.8538218017229,170.489947694603,327.20083955972,81.1152873787887,165.417736955428,330.993421168037,80.880205177774,159.854681048198]

dummySurface = GS.Surface [(*0.3)] [(*0.3)] Bezier Bezier [[]] [] 
dummyCurve = GC.Curve [(*0.3)] Bezier []

test = GS.mkBSpline dU kU dV kV cps
test2 = fromMaybe dummySurface $ 
  GS.mkBSpline dUerr kUerr dVerr kVerr cpsErr
test3 = fromMaybe dummyCurve $ GC.mkBSpline dUerr kUerr (flattenV3List $ head (GS.cvs test2))
test4 = fromMaybe dummyCurve $ GC.mkBSpline dUerr (normalizeKnots kUerr) (flattenV3List $ head (GS.cvs test2))

main :: IO () 
main = do 
  case test of 
    Nothing -> putStrLn "FAILURE!"
    Just _  -> putStrLn "SUCCESS!!"


dUerr = 5
dVerr = 7
kUerr = [1.0,1.0,1.0,1.0,1.0,1.0,1.03889756001266,1.06842941968125,1.09421499921222,1.12000057874318,1.14578615827414,1.23111901704222,1.35727125431998,1.58305728739083,2.0,2.0,2.0,2.0,2.0,2.0]
kVerr = [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.37536515603679,1.37536515603679,1.37536515603679,1.37536515603679,1.37536515603679,1.37536515603679,1.37536515603679,1.37536515603679]
cpsErr = [150.03741345499,58.250115707891,-7.278651219006974,150.04024305299,58.2001857134062,-7.279172280716011,150.0428046141101,58.1502401818095,-7.279658786938001,150.0380894575801,58.0573672122225,-7.275136409277025,150.0450978404699,57.9405260650509,-7.271969961818002,150.0713654941701,57.8024485135491,-7.270937867811995,150.1353097400099,57.6257990914001,-7.274066066781018,150.2712580693501,57.3738887537221,-7.28514970089401,150.6287238805501,56.9909413302559,-7.32018872407599,151.03949495384,56.4144408743548,-7.361676173237981,150.7239755957,56.0461684881901,-7.325234034711002,150.0035648882599,55.8320877163885,-7.244765862793997,149.33416461254,55.7071929723561,-7.169014307493001,149.10828378665,55.6893360534568,-7.091900718735985,149.98184485456,58.2491813378673,-7.802856702193026,149.9846658992001,58.1992513133293,-7.803426924258986,149.9872194546799,58.1493057452572,-7.80395833555599,149.98257558711,58.0564321213956,-7.799368962191977,149.98963358985,57.939590528478,-7.796323688583016,150.0159168439,57.8015129062522,-7.79572035595902,150.0798104000701,57.6248641517575,-7.799878790382024,150.2155812644401,57.3729558902255,-7.813142274774009,150.5724883988801,56.990015052091,-7.853889366173974,150.98259729966,56.413521968936,-7.901947641300012,150.6676546782101,56.0452417363506,-7.860527113605997,149.9485208265901,55.831144667302,-7.768638882020014,149.2803229853,55.706234858029,-7.682269614557981,149.05566656614,55.6883684424155,-7.601571068462022,149.91665950275,58.2454270002142,-8.326043141758987,149.9195879282599,58.1954928087327,-8.325648624844007,149.9222495055301,58.1455431894497,-8.32521095908902,149.91789103927,58.0527509951077,-8.318678298057023,149.9252663236,57.9359890384961,-8.313382564565018,149.95187848969,57.7979899101761,-8.310390062552017,150.01611699502,57.6214177109519,-8.311947957291977,150.15226701351,57.3695822095576,-8.32217575724502,150.50943274321,56.9867125327437,-8.360576008287978,150.9201375077701,56.4102770758267,-8.403184549928994,150.6066914155299,56.0420482329856,-8.34958922172001,149.8894763836699,55.8280106719445,-8.242546042824983,149.22290423048,55.7031756653826,-8.143588556273983,148.99951703131,55.686375188376,-8.059147333986004,149.84207546127,58.2360816162158,-8.847967579758972,149.8448978653801,58.18616114527,-8.848815459921013,149.8474540883101,58.1362250847072,-8.849616152297017,149.8429942904099,58.0433519207639,-8.845234010302022,149.85019334513,57.9265163384233,-8.84285512902602,149.8765425535,57.78845042988,-8.84360401444701,149.940354505,57.6118239774091,-8.850445067334988,150.0757621621401,57.3599585387215,-8.868939571984981,150.4314155248601,56.9771046637611,-8.922378000678009,150.8401003116101,56.4007392061276,-8.985535160678978,150.5267236397201,56.0324817347902,-8.935590355421027,149.81082557734,55.8183403426902,-8.821864870258025,149.14563536931,55.6933731490494,-8.714925509035027,148.9236084772899,55.675292514372,-8.62724636776602,149.75789706511,58.2290105628877,-9.368423821522015,149.7609224666001,58.1790707344423,-9.367327675517004,149.7636825228001,58.1291155393561,-9.366180025334018,149.75968638166,58.0363817451752,-9.35804508619799,149.76742198633,57.9196768732935,-9.351125348485994,149.79435160706,57.7817350505599,-9.346759184199016,149.85881706225,57.6052209947876,-9.347480124762,149.9950246925801,57.3534450750439,-9.357872262881017,150.35150748665,56.970652756749,-9.401102766273993,150.76170964474,56.3942798563478,-9.447108567097985,150.4506888030701,56.0260343148566,-9.378120376365985,149.7374597478099,55.8119470416131,-9.245810918086022,149.07444798334,55.6870851665531,-9.124544832890024,148.85377966744,55.6710945403984,-9.033029644248984,149.66453454002,58.2215916440303,-9.887347715134013,149.6672562968799,58.1716764133846,-9.889198432111982,149.6697134119299,58.1217454242437,-9.890993922591974,149.66525708994,58.0287989657556,-9.88817699775501,149.67235654403,57.9118947476827,-9.888165505743018,149.6984682868899,57.7737659433855,-9.892267273733978,149.7617784353099,57.5970874891833,-9.904334524325975,149.8961763249299,57.3451909876674,-9.931663722232997,150.24943223575,56.9623596646929,-10.00319612336898,150.6551084099599,56.3860442525515,-10.08964537700302,150.34290403356,56.0176750963786,-10.03669325360499,149.6305873839999,55.8033207195137,-9.904601419866992,148.9688724502601,55.6781367249146,-9.779240533513018,148.7496632443199,55.6590397241838,-9.685001537679,149.56195028293,58.2135766460278,-10.40440768405102,149.56505899542,58.163634493781,-10.40272883725697,149.5679041277499,58.1136770027198,-10.4009903855,149.5642518771899,58.0209963303766,-10.391486699214,149.5723126176299,57.904345665227,-10.38322585979302,149.5995009706701,57.7664610515396,-10.37780604112697,149.6640892057301,57.5900102993894,-10.37807544966501,149.80016312775,57.3383092554647,-10.38914610136902,150.1555253845199,56.9556343555302,-10.43787359316502,150.5646927379801,56.3793800027406,-10.48837290401002,150.2563239430101,56.0111054041417,-10.40512506184598,149.54773883907,55.7969146001937,-10.24861119347997,148.88891457209,55.6719696818002,-10.10584444729398,148.6711491921999,55.6566445340372,-10.00752566751498,149.45036768606,58.2087328390876,-10.919609532381,149.4530179276201,58.1588171512826,-10.92202874480802,149.4554053362101,58.1088855675056,-10.92438486998202,149.45101158027,58.0158925942276,-10.92234031619,149.45807495585,57.8989445778986,-10.923683601623,149.48400850962,57.7607767793764,-10.92992123598998,149.5468658595901,57.5840687722234,-10.945623509548,149.68028441668,57.3321607094325,-10.979467799774,150.03105216728,56.9493749518039,-11.06540173297401,150.4337028371699,56.3731144938053,-11.169720893668,150.12319150534,56.0046039257662,-11.11092847627401,149.4152520866101,55.7899956133027,-10.959410270528,148.7577042283101,55.664571185526,-10.81528289943998,148.54148079117,55.6448959076664,-10.71462613218]

